(self.webpackChunksite=self.webpackChunksite||[]).push([[3334],{3905:function(e,t,n){"use strict";n.d(t,{Zo:function(){return d},kt:function(){return k}});var a=n(7294);function r(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function l(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function o(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?l(Object(n),!0).forEach((function(t){r(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):l(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function i(e,t){if(null==e)return{};var n,a,r=function(e,t){if(null==e)return{};var n,a,r={},l=Object.keys(e);for(a=0;a<l.length;a++)n=l[a],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(e);for(a=0;a<l.length;a++)n=l[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}var p=a.createContext({}),u=function(e){var t=a.useContext(p),n=t;return e&&(n="function"==typeof e?e(t):o(o({},t),e)),n},d=function(e){var t=u(e.components);return a.createElement(p.Provider,{value:t},e.children)},s={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},c=a.forwardRef((function(e,t){var n=e.components,r=e.mdxType,l=e.originalType,p=e.parentName,d=i(e,["components","mdxType","originalType","parentName"]),c=u(n),k=r,g=c["".concat(p,".").concat(k)]||c[k]||s[k]||l;return n?a.createElement(g,o(o({ref:t},d),{},{components:n})):a.createElement(g,o({ref:t},d))}));function k(e,t){var n=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var l=n.length,o=new Array(l);o[0]=c;var i={};for(var p in t)hasOwnProperty.call(t,p)&&(i[p]=t[p]);i.originalType=e,i.mdxType="string"==typeof e?e:r,o[1]=i;for(var u=2;u<l;u++)o[u]=n[u];return a.createElement.apply(null,o)}return a.createElement.apply(null,n)}c.displayName="MDXCreateElement"},6903:function(e,t,n){"use strict";n.r(t),n.d(t,{frontMatter:function(){return o},metadata:function(){return i},toc:function(){return p},default:function(){return d}});var a=n(2122),r=n(9756),l=(n(7294),n(3905)),o={title:"\u901a\u8fc7\u63d2\u4ef6\u5b9a\u5236\u5de5\u7a0b\u80fd\u529b",order:2},i={unversionedId:"plugin/develop/build",id:"plugin/develop/build",isDocsHomePage:!1,title:"\u901a\u8fc7\u63d2\u4ef6\u5b9a\u5236\u5de5\u7a0b\u80fd\u529b",description:"\u63d2\u4ef6\u5de5\u7a0b\u80fd\u529b\u901a\u8fc7 src/index.ts \u5b9a\u4e49\uff0c\u7ed3\u6784\u5982\u4e0b",source:"@site/docs/plugin/develop/build.md",sourceDirName:"plugin/develop",slug:"/plugin/develop/build",permalink:"/docs/plugin/develop/build",editUrl:"https://github.com/ice-lab/site/edit/master/website/docs/plugin/develop/build.md",version:"current",frontMatter:{title:"\u901a\u8fc7\u63d2\u4ef6\u5b9a\u5236\u5de5\u7a0b\u80fd\u529b",order:2},sidebar:"plugin",previous:{title:"\u63d2\u4ef6\u5f00\u53d1\u6307\u5357",permalink:"/docs/plugin/develop/start"},next:{title:"\u901a\u8fc7\u63d2\u4ef6\u5b9a\u5236\u8fd0\u884c\u65f6\u80fd\u529b",permalink:"/docs/plugin/develop/runtime"}},p=[{value:"\u63d2\u4ef6 API",id:"\u63d2\u4ef6-api",children:[{value:"context",id:"context",children:[]},{value:"onGetWebpackConfig",id:"ongetwebpackconfig",children:[]},{value:"onGetJestConfig",id:"ongetjestconfig",children:[]},{value:"onHook",id:"onhook",children:[]},{value:"log",id:"log",children:[]},{value:"registerUserConfig",id:"registeruserconfig",children:[]},{value:"registerClioption",id:"registerclioption",children:[]},{value:"registerMethod",id:"registermethod",children:[]},{value:"modifyUserConfig",id:"modifyuserconfig",children:[]},{value:"registerTask",id:"registertask",children:[]},{value:"getAllTask",id:"getalltask",children:[]},{value:"getAllPlugin",id:"getallplugin",children:[]}]},{value:"\u6269\u5c55 API",id:"\u6269\u5c55-api",children:[{value:"addIceExport",id:"addiceexport",children:[]},{value:"removeIceExport",id:"removeiceexport",children:[]},{value:"addPageExport",id:"addpageexport",children:[]},{value:"removePageExport",id:"removepageexport",children:[]},{value:"addIceAppConfigTypes",id:"addiceappconfigtypes",children:[]},{value:"removeIceAppConfigTypes",id:"removeiceappconfigtypes",children:[]},{value:"getPages",id:"getpages",children:[]},{value:"watchFileChange",id:"watchfilechange",children:[]}]},{value:"\u63d2\u4ef6\u53c2\u6570",id:"\u63d2\u4ef6\u53c2\u6570",children:[]},{value:"\u63d2\u4ef6\u901a\u4fe1",id:"\u63d2\u4ef6\u901a\u4fe1",children:[{value:"setValue",id:"setvalue",children:[]},{value:"getValue",id:"getvalue",children:[]}]},{value:"\u7c7b\u578b",id:"\u7c7b\u578b",children:[]}],u={toc:p};function d(e){var t=e.components,n=(0,r.Z)(e,["components"]);return(0,l.kt)("wrapper",(0,a.Z)({},u,n,{components:t,mdxType:"MDXLayout"}),(0,l.kt)("p",null,"\u63d2\u4ef6\u5de5\u7a0b\u80fd\u529b\u901a\u8fc7 ",(0,l.kt)("inlineCode",{parentName:"p"},"src/index.ts")," \u5b9a\u4e49\uff0c\u7ed3\u6784\u5982\u4e0b"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-javascript"},"module.exports = ({ context, onGetWebpackConfig, log, onHook, ...rest }, options) => {\n  // \u7b2c\u4e00\u9879\u53c2\u6570\u4e3a\u63d2\u4ef6 API \u63d0\u4f9b\u7684\u80fd\u529b\n  // options\uff1a\u63d2\u4ef6\u81ea\u5b9a\u4e49\u53c2\u6570\n};\n")),(0,l.kt)("p",null,"\u8be5\u65b9\u6cd5\u4f1a\u63a5\u6536\u4e24\u4e2a\u53c2\u6570\uff0c\u7b2c\u4e00\u4e2a\u53c2\u6570\u662f\u63d2\u4ef6\u63d0\u4f9b\u7684 API \u63a5\u53e3\uff0c\u63a8\u8350\u6309\u7167\u89e3\u6784\u65b9\u5f0f\u4f7f\u7528\uff0c\u7b2c\u4e8c\u4e2a\u53c2\u6570\xa0",(0,l.kt)("inlineCode",{parentName:"p"},"options"),"\xa0\u662f\u63d2\u4ef6\u81ea\u5b9a\u4e49\u7684\u53c2\u6570\uff0c\u7531\u63d2\u4ef6\u5f00\u53d1\u8005\u51b3\u5b9a\u63d0\u4f9b\u54ea\u4e9b\u9009\u9879\u7ed9\u7528\u6237\u914d\u7f6e\u3002"),(0,l.kt)("h2",{id:"\u63d2\u4ef6-api"},"\u63d2\u4ef6 API"),(0,l.kt)("p",null,"\u901a\u8fc7\u63d2\u4ef6\u63d0\u4f9b\u7684 API\uff0c\u53ef\u4ee5\u65b9\u4fbf\u62d3\u5c55\u548c\u81ea\u5b9a\u4e49\u80fd\u529b\u3002"),(0,l.kt)("h3",{id:"context"},"context"),(0,l.kt)("p",null,"\u5305\u542b\u8fd0\u884c\u65f6\u7684\u5404\u79cd\u73af\u5883\u4fe1\u606f\uff1a"),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("inlineCode",{parentName:"li"},"command")," \u5f53\u524d\u8fd0\u884c\u547d\u4ee4\uff0cstart/build/test"),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("inlineCode",{parentName:"li"},"commandArgs")," script \u547d\u4ee4\u6267\u884c\u65f6\u63a5\u53d7\u5230\u7684\u53c2\u6570"),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("inlineCode",{parentName:"li"},"rootDir")," \u9879\u76ee\u6839\u76ee\u5f55"),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("inlineCode",{parentName:"li"},"userConfig")," \u7528\u6237\u5728 build.json \u4e2d\u914d\u7f6e\u7684\u5185\u5bb9"),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("inlineCode",{parentName:"li"},"pkg")," \u9879\u76ee package.json \u4e2d\u7684\u5185\u5bb9")),(0,l.kt)("h3",{id:"ongetwebpackconfig"},"onGetWebpackConfig"),(0,l.kt)("p",null,"\u901a\u8fc7 ",(0,l.kt)("inlineCode",{parentName:"p"},"onGetWebpackConfig")," \u83b7\u53d6 webpack-chain \u5f62\u5f0f\u7684\u914d\u7f6e\uff0c\u5e76\u5bf9\u914d\u7f6e\u8fdb\u884c\u81ea\u5b9a\u4e49\u4fee\u6539\uff1a"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-javascript"},"module.exports = ({onGetWebpackConfig, registerTask}) => {\n  registerTask('default', webpackConfig);\n\n  onGetWebpackConfig((config) => {\n    config.entry('xxx');\n  });\n}\n")),(0,l.kt)("h3",{id:"ongetjestconfig"},"onGetJestConfig"),(0,l.kt)("p",null,"\u901a\u8fc7 ",(0,l.kt)("inlineCode",{parentName:"p"},"onGetJestConfig")," \u83b7\u53d6 jest \u914d\u7f6e\uff0c\u53ef\u5bf9\u914d\u7f6e\u8fdb\u884c\u81ea\u5b9a\u4e49\u4fee\u6539\uff1a"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-javascript"},"module.exports = ({onGetJestConfig}) => {\n  onGetJestConfig((jestConfig) => {\n    const modifiedJestConfig = modify(jestConfig);\n      return modifiedJestConfig;\n  });\n};\n")),(0,l.kt)("h3",{id:"onhook"},"onHook"),(0,l.kt)("p",null,"\u901a\u8fc7 onHook \u76d1\u542c\u547d\u4ee4\u8fd0\u884c\u65f6\u4e8b\u4ef6\uff0conHook \u6ce8\u518c\u7684\u51fd\u6570\u6267\u884c\u5b8c\u6210\u540e\u624d\u4f1a\u6267\u884c\u540e\u7eed\u64cd\u4f5c\uff0c\u53ef\u4ee5\u7528\u4e8e\u5728\u547d\u4ee4\u8fd0\u884c\u4e2d\u9014\u63d2\u5165\u63d2\u4ef6\u60f3\u505a\u7684\u64cd\u4f5c\uff1a"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-javascript"},"module.exports = ({ onHook }) => {\n onHook('before.build.load', () => {\n   // do something before dev\n });\n onHook('after.build.compile', (stats) => {\n   // do something after build\n });\n}\n")),(0,l.kt)("p",null,"\u76ee\u524d\u652f\u6301\u7684\u547d\u4ee4\u6267\u884c\u751f\u547d\u5468\u671f\u5982\u4e0b\uff1a"),(0,l.kt)("h4",{id:"start-\u547d\u4ee4"},"start \u547d\u4ee4"),(0,l.kt)("table",null,(0,l.kt)("thead",{parentName:"table"},(0,l.kt)("tr",{parentName:"thead"},(0,l.kt)("th",{parentName:"tr",align:null},"\u751f\u547d\u5468\u671f"),(0,l.kt)("th",{parentName:"tr",align:null},"\u53c2\u6570"),(0,l.kt)("th",{parentName:"tr",align:null},"\u8c03\u7528\u65f6\u673a"))),(0,l.kt)("tbody",{parentName:"table"},(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},"before.start.load"),(0,l.kt)("td",{parentName:"tr",align:null},"{",(0,l.kt)("br",null),"\xa0 args: array // \u542f\u52a8\u53c2\u6570",(0,l.kt)("br",null),"}"),(0,l.kt)("td",{parentName:"tr",align:null},"\u83b7\u53d6webpack\u914d\u7f6e\u4e4b\u524d")),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},"before.start.run"),(0,l.kt)("td",{parentName:"tr",align:null},"-"),(0,l.kt)("td",{parentName:"tr",align:null},"webpack\u6267\u884c\u4e4b\u524d")),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},"after.start.compile"),(0,l.kt)("td",{parentName:"tr",align:null},"{",(0,l.kt)("br",null),"\xa0\xa0url: string // serverUrl\uff0c",(0,l.kt)("br",null),"\xa0 stats: WebpackAssets",(0,l.kt)("br",null),"}"),(0,l.kt)("td",{parentName:"tr",align:null},"\u7f16\u8bd1\u7ed3\u675f\uff0c\u6bcf\u6b21\u91cd\u65b0\u7f16\u8bd1\u90fd\u4f1a\u6267\u884c")),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},"before.start.devServer"),(0,l.kt)("td",{parentName:"tr",align:null},"{",(0,l.kt)("br",null),"\xa0 url: string // serverUrl\uff0c",(0,l.kt)("br",null),"\xa0devServer:\xa0\xa0WebpackDevServer",(0,l.kt)("br",null),"}"),(0,l.kt)("td",{parentName:"tr",align:null},"\u4e2d\u95f4\u4ef6\u52a0\u8f7d\u540e\uff0cwebpack dev server \u542f\u52a8\u524d")),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},"after.start.devServer"),(0,l.kt)("td",{parentName:"tr",align:null},"{",(0,l.kt)("br",null),"\xa0 url: string // serverUrl,",(0,l.kt)("br",null),"\xa0 devServer: WebpackDevServer,",(0,l.kt)("br",null),"\xa0 err: Error",(0,l.kt)("br",null),"}"),(0,l.kt)("td",{parentName:"tr",align:null},"webpack dev server \u542f\u52a8\u540e")))),(0,l.kt)("h4",{id:"build-\u547d\u4ee4"},"build \u547d\u4ee4"),(0,l.kt)("table",null,(0,l.kt)("thead",{parentName:"table"},(0,l.kt)("tr",{parentName:"thead"},(0,l.kt)("th",{parentName:"tr",align:null},"\u751f\u547d\u5468\u671f"),(0,l.kt)("th",{parentName:"tr",align:null},"\u53c2\u6570"),(0,l.kt)("th",{parentName:"tr",align:null},"\u8c03\u7528\u65f6\u673a"))),(0,l.kt)("tbody",{parentName:"table"},(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},"before.build.load"),(0,l.kt)("td",{parentName:"tr",align:null},"{",(0,l.kt)("br",null),"\xa0 args: array // \u542f\u52a8\u53c2\u6570",(0,l.kt)("br",null),"}"),(0,l.kt)("td",{parentName:"tr",align:null},"\u83b7\u53d6 webpack \u914d\u7f6e\u4e4b\u524d")),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},"before.build.run"),(0,l.kt)("td",{parentName:"tr",align:null},"-"),(0,l.kt)("td",{parentName:"tr",align:null},"webpack \u6784\u5efa\u6267\u884c\u4e4b\u524d")),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},"after.build.compile"),(0,l.kt)("td",{parentName:"tr",align:null},"{",(0,l.kt)("br",null),"\xa0 err: Error,",(0,l.kt)("br",null),"\xa0 stats: WebpackAssets",(0,l.kt)("br",null),"}"),(0,l.kt)("td",{parentName:"tr",align:null},"\u6784\u5efa\u7ed3\u675f")))),(0,l.kt)("h4",{id:"test-\u547d\u4ee4"},"test \u547d\u4ee4"),(0,l.kt)("table",null,(0,l.kt)("thead",{parentName:"table"},(0,l.kt)("tr",{parentName:"thead"},(0,l.kt)("th",{parentName:"tr",align:null},"\u751f\u547d\u5468\u671f"),(0,l.kt)("th",{parentName:"tr",align:null},"\u53c2\u6570"),(0,l.kt)("th",{parentName:"tr",align:null},"\u8c03\u7528\u65f6\u673a"))),(0,l.kt)("tbody",{parentName:"table"},(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},"before.test.load"),(0,l.kt)("td",{parentName:"tr",align:null},"{",(0,l.kt)("br",null),"\xa0 args: array // \u542f\u52a8\u53c2\u6570",(0,l.kt)("br",null),"}"),(0,l.kt)("td",{parentName:"tr",align:null},"\u83b7\u53d6 jest \u914d\u7f6e\u4e4b\u524d")),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},"before.test.run"),(0,l.kt)("td",{parentName:"tr",align:null},"-"),(0,l.kt)("td",{parentName:"tr",align:null},"jest \u6267\u884c\u4e4b\u524d")),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},"after.test"),(0,l.kt)("td",{parentName:"tr",align:null},"{",(0,l.kt)("br",null),"\xa0 result // jest\u6267\u884c\u7ed3\u679c",(0,l.kt)("br",null),"}"),(0,l.kt)("td",{parentName:"tr",align:null},"\u6d4b\u8bd5\u547d\u4ee4\u6267\u884c\u7ed3\u675f")))),(0,l.kt)("h3",{id:"log"},"log"),(0,l.kt)("p",null,"\u7edf\u4e00\u7684 log \u5de5\u5177\uff0c\u5e95\u5c42\u4f7f\u7528 ",(0,l.kt)("inlineCode",{parentName:"p"},"npmlog")," \uff0c\u4fbf\u4e8e\u751f\u6210\u7edf\u4e00\u683c\u5f0f\u7684 log\u3002"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-js"},"log.info('start');\nlog.verbose('debug');\nlog.error('exit');\n")),(0,l.kt)("h3",{id:"registeruserconfig"},"registerUserConfig"),(0,l.kt)("p",null,"\u4e3a\u7528\u6237\u914d\u7f6e\u6587\u4ef6 ",(0,l.kt)("inlineCode",{parentName:"p"},"build.json")," \u4e2d\u6dfb\u52a0\u81ea\u5b9a\u4e49\u5b57\u6bb5\u3002"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-javascript"},"module.exports = ({registerUserConfig}) => {\n  registerUserConfig({\n    name: 'custom-key',\n    validation: 'boolean' // \u53ef\u9009\uff0c\u652f\u6301\u7c7b\u578b\u6709 string, number, array, object, boolean\n  });\n};\n")),(0,l.kt)("h3",{id:"registerclioption"},"registerClioption"),(0,l.kt)("p",null,"\u4e3a\u547d\u4ee4\u884c\u542f\u52a8\u6dfb\u52a0\u81ea\u5b9a\u4e49\u53c2\u6570\u3002"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-javascript"},"module.exports = ({registerClioption}) => {\n  registerCliOption({\n    name: 'custom-option', // \u53c2\u6570\u540d\n    commands: ['start'], // \u547d\u4ee4\n    configWebpack: (arg) => {} // \u53ef\u9009\uff0carg \u4e3a\u547d\u4ee4\u884c\u53c2\u6570\u5bf9\u5e94\u503c\n  });\n};\n")),(0,l.kt)("h3",{id:"registermethod"},"registerMethod"),(0,l.kt)("p",null,"\u6ce8\u518c\u81ea\u5b9a\u4e49\u65b9\u6cd5\u3002\u901a\u8fc7 ",(0,l.kt)("inlineCode",{parentName:"p"},"applyMethod")," \u8c03\u7528\u3002"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-javascript"},"module.exports = ({registerMethod}) => {\n  registerMethod(name, func); // name, func \u5206\u522b\u4e3a\u65b9\u6cd5\u540d\u548c\u65b9\u6cd5\n};\n")),(0,l.kt)("h3",{id:"modifyuserconfig"},"modifyUserConfig"),(0,l.kt)("p",null,"\u4fee\u6539\u7528\u6237\u914d\u7f6e\u6587\u4ef6\u3002"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-javascript"},"module.exports = ({modifyUserConfig}) => {\n  modifyUserConfig(key, value); // key, value \u5206\u522b\u4e3a\u7528\u6237\u914d\u7f6e\u6587\u4ef6\u952e\u503c\u5bf9\n};\n")),(0,l.kt)("h3",{id:"registertask"},"registerTask"),(0,l.kt)("p",null,"\u6dfb\u52a0 webpack \u914d\u7f6e\uff0c\u914d\u7f6e\u4e3a webpack-chain \u5f62\u5f0f\u3002"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-javascript"},"module.exports = ({registerTask}) => {\n  registerTask(name, config); // name: Task\u540d, config: webpack-chain \u5f62\u5f0f\u7684\u914d\u7f6e\n};\n")),(0,l.kt)("h3",{id:"getalltask"},"getAllTask"),(0,l.kt)("p",null,"\u83b7\u53d6\u6240\u6709 webpack \u914d\u7f6e\u540d\u79f0\u3002"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-javascript"},"module.exports = ({getAllTask}) => {\n  const alltasks = getAlltask();\n};\n")),(0,l.kt)("h3",{id:"getallplugin"},"getAllPlugin"),(0,l.kt)("p",null,"\u83b7\u53d6\u6240\u6709\u63d2\u4ef6\u3002"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-javascript"},"module.exports = ({getAllPlugin}) => {\n  // \u83b7\u53d6\u6240\u6709\u63d2\u4ef6\u6570\u7ec4\n  // \u7c7b\u578b\uff1a() => [{pluginPath, options, name}]\n  const plugins = getAllPlugin(); \uff0c[]\n}\n")),(0,l.kt)("h2",{id:"\u6269\u5c55-api"},"\u6269\u5c55 API"),(0,l.kt)("p",null,"\u9664\u4e86\u4ee5\u4e0a\u7531 build-scripts \u5185\u7f6e\u652f\u6301\u7684 API\uff0c\u6211\u4eec\u8fd8\u901a\u8fc7 icejs \u5bf9\u63d2\u4ef6 API \u505a\u4e86\u6269\u5c55\uff0c\u6269\u5c55\u7684 API \u9700\u8981\u901a\u8fc7\u4ee5\u4e0b\u65b9\u5f0f\u8c03\u7528\uff1a"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-js"},"module.exports = ({ applyMethod }) => {\n  // \u7b2c\u4e00\u4e2a\u53c2\u6570\u5bf9\u5e94 API \u540d\u79f0\uff0c\u7b2c\u4e8c\u4e2a\u53c2\u6570\u5bf9\u5e94 API \u53c2\u6570\n  applyMethod('addIceExport', { source: `./config`, exportName });\n}\n")),(0,l.kt)("p",null,"\u76ee\u524d\u6269\u5c55\u7684 API \u4ec5\u652f\u6301\u540c\u6b65\u8c03\u7528\u3002"),(0,l.kt)("h3",{id:"addiceexport"},"addIceExport"),(0,l.kt)("p",null,"\u5411 ",(0,l.kt)("inlineCode",{parentName:"p"},"ice")," \u91cc\u6ce8\u518c\u6a21\u5757\uff0c\u5b9e\u73b0 ",(0,l.kt)("inlineCode",{parentName:"p"},"import { foo } from 'ice';")," \u7684\u80fd\u529b\uff1a"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-js"},"// \u5b9e\u73b0 import { request } from 'ice'; request \u7531\u63d2\u4ef6\u7684 `./request/request` \u6587\u4ef6\u5b9e\u73b0\napplyMethod('addIceExport', { source: './request/request', exportName: 'request' })\n")),(0,l.kt)("h3",{id:"removeiceexport"},"removeIceExport"),(0,l.kt)("p",null,"\u4e0e ",(0,l.kt)("inlineCode",{parentName:"p"},"addIceExport")," \u5bf9\u5e94\uff1a"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-js"},"this.applyMethod('removeIceExport', 'store');\n")),(0,l.kt)("h3",{id:"addpageexport"},"addPageExport"),(0,l.kt)("p",null,"\u5411 ",(0,l.kt)("inlineCode",{parentName:"p"},"ice/Home")," \u91cc\u6ce8\u518c\u6a21\u5757\uff0c\u5b9e\u73b0 ",(0,l.kt)("inlineCode",{parentName:"p"},"import { foo } from 'ice/Home'"),"\uff0c\u76ee\u524d\u4e3b\u8981\u7528\u4e8e\u9875\u9762\u7ea7\u72b6\u6001\u7ba1\u7406\u7684\u5b9e\u73b0\uff1a"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-js"},"this.applyMethod('addPageExport', 'Home', { source: './models', 'store' })\n")),(0,l.kt)("p",null,"\u4e00\u822c\u60c5\u51b5\u4e0b\u9700\u8981\u5faa\u73af\u5411\u6bcf\u4e2a\u9875\u9762\u6dfb\u52a0\u3002"),(0,l.kt)("h3",{id:"removepageexport"},"removePageExport"),(0,l.kt)("p",null,"\u4e0e ",(0,l.kt)("inlineCode",{parentName:"p"},"addPageExport")," \u5bf9\u5e94"),(0,l.kt)("h3",{id:"addiceappconfigtypes"},"addIceAppConfigTypes"),(0,l.kt)("p",null,"\u5411 appConfig \u6dfb\u52a0\u7c7b\u578b"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-javascript"},"// \u7b2c\u4e00\u9879\u53c2\u6570\u5bf9\u5e94 API \u540d\u79f0\uff0c\u7b2c\u4e8c\u9879\u53c2\u6570\u5bf9\u5e94 API \u53c2\u6570\u3002\n//\n// API \u53c2\u6570\uff1a\n// source: \u7c7b\u578b\u58f0\u660e\u6587\u4ef6\u3002./foo/types\uff0c\u5bf9\u5e94 ICE_TEMP_DIR/foo/types\u3002 ICE_TEMP_DIR\uff0c\u53ef\u901a\u8fc7 getValue('TEMP_PATH') \u83b7\u5f97\u3002\u6ce8\u610f\uff1a\u9700\u5148\u5c06\u5bf9\u5e94\u7c7b\u578b\u6587\u4ef6\u79fb\u81f3 ICE_TEMP_DIR\u3002\n// specifier: \u5bfc\u51fa\u7c7b\u578b\u6807\u8bc6\u7b26\uff0c\u53ef\u9009\uff0c\u9ed8\u8ba4\u503c\u4e3a '*'\u3002\n// exportName: \u6dfb\u52a0\u81f3 appConfig \u7c7b\u578b IAppConfig \u4e0a\u7684\u5bfc\u51fa\u540d\u3002\n//\n// \u7ed3\u679c\u4e3a\uff1a\n// // ICE_TEMP_DIR/types.ts\n// import { Foo } from './foo/types';\n// export interface IAppConfig {\n//   foo?: Foo\n// }\napplyMethod('addIceAppConfigTypes', { source: `./foo/types`, specifier: '{ Foo }', exportName: `foo?: Foo` });\n")),(0,l.kt)("h3",{id:"removeiceappconfigtypes"},"removeIceAppConfigTypes"),(0,l.kt)("p",null,"\u4e0e ",(0,l.kt)("inlineCode",{parentName:"p"},"addIceAppConfigTypes")," \u5bf9\u5e94"),(0,l.kt)("h3",{id:"getpages"},"getPages"),(0,l.kt)("p",null,"\u83b7\u53d6 ",(0,l.kt)("inlineCode",{parentName:"p"},"src/pages")," \u4e0b\u7684\u4e00\u7ea7\u9875\u9762\u5217\u8868\uff1a"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-js"},"// ['Home', 'About']\nconst pages = this.applyMethod('getPages', this.rootDir);\n")),(0,l.kt)("h3",{id:"watchfilechange"},"watchFileChange"),(0,l.kt)("p",null,"\u76d1\u542c ",(0,l.kt)("inlineCode",{parentName:"p"},"src")," \u4e0b\u7684\u6587\u4ef6\u53d8\u5316\uff1a"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-js"},"applyMethod('watchFileChange', 'src/config.*', async (event: string) => {\n  if (event === 'unlink' || event === 'add') {\n    // do something\n  }\n});\n")),(0,l.kt)("h2",{id:"\u63d2\u4ef6\u53c2\u6570"},"\u63d2\u4ef6\u53c2\u6570"),(0,l.kt)("p",null,"\u7528\u6237\u53ef\u4ee5\u5728 ",(0,l.kt)("inlineCode",{parentName:"p"},"build.json")," \u4e2d\u6307\u5b9a\u63d2\u4ef6\u53c2\u6570\uff1a"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-json"},'{\n  "plugins": [\n    ["build-plugin-foo", {\n      "type": "bar"\n    }]\n  ]\n}\n')),(0,l.kt)("p",null,"\u90a3\u4e48\u5728 build-plugin-foo \u91cc\u5c31\u53ef\u4ee5\u83b7\u53d6\u5230\u8fd9\u4e2a\u53c2\u6570\uff1a"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-js"},"module.exports = ({ context, log }, options) => {\n  const { type } = options;\n  log.info(type); // => bar\n}\n")),(0,l.kt)("h2",{id:"\u63d2\u4ef6\u901a\u4fe1"},"\u63d2\u4ef6\u901a\u4fe1"),(0,l.kt)("p",null,"\u63d2\u4ef6\u95f4\u9700\u8981\u8fdb\u884c\u901a\u4fe1\u7684\u573a\u666f\u8bc9\u6c42\uff1a"),(0,l.kt)("ol",null,(0,l.kt)("li",{parentName:"ol"},"\u4e0d\u540c\u63d2\u4ef6\u4e4b\u95f4\u9700\u8981\u77e5\u9053\u5f7c\u6b64\u7684\u5b58\u5728\u6765\u786e\u5b9a\u662f\u5426\u6267\u884c\u76f8\u5e94\u7684\u903b\u8f91"),(0,l.kt)("li",{parentName:"ol"},"\u591a\u4e2a\u63d2\u4ef6\u5171\u6709\u7684\u914d\u7f6e\u4fe1\u606f\u53ef\u4ee5\u62bd\u51fa\u6765\uff0c\u5728\u67d0\u4e2a\u63d2\u4ef6\u4e2d\u8fdb\u884c\u914d\u7f6e")),(0,l.kt)("p",null,"\u4f7f\u7528 ",(0,l.kt)("inlineCode",{parentName:"p"},"setValue"),"\xa0\u548c ",(0,l.kt)("inlineCode",{parentName:"p"},"getValue"),"\xa0\u4e24\u4e2aAPI\u6765\u5b9e\u73b0\uff0c\u5206\u522b\u7528\u4e8e\u6570\u636e\u7684\u5b58\u53d6\u3002"),(0,l.kt)("h3",{id:"setvalue"},"setValue"),(0,l.kt)("p",null,"\u7c7b\u578b\uff1a",(0,l.kt)("inlineCode",{parentName:"p"},"(key: string | number, value: any) => void"),"\uff0c\u793a\u4f8b\uff1a"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-javascript"},"// build-plugin-test\nmodule.exports = ({ setValue }) => {\n  setValue('key', 123);\n}\n")),(0,l.kt)("h3",{id:"getvalue"},"getValue"),(0,l.kt)("p",null,"\u7c7b\u578b\uff1a",(0,l.kt)("inlineCode",{parentName:"p"},"(key: string | number) => any"),"\uff0c\u793a\u4f8b\uff1a"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-javascript"},"module.exports = ({getValue}) => {\n  const value = getValue('key'); // 123\n}\n")),(0,l.kt)("p",null,"\u540c\u65f6\u5728 icejs \u4e2d\u4e5f\u5185\u7f6e\u4e86\u51e0\u4e2a\u53d8\u91cf\uff1a"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-js"},"const projectType = getValue('PROJECT_TYPE'); // ts|js\nconst iceDirPath = getValue('TEMP_PATH');  // \u5bf9\u5e94 .ice \u7684\u8def\u5f84\n")),(0,l.kt)("h2",{id:"\u7c7b\u578b"},"\u7c7b\u578b"),(0,l.kt)("p",null,"\u63a5\u53e3\u7c7b\u578b\u901a\u8fc7\u4ee5\u4e0b\u65b9\u6cd5\u5f15\u5165\uff1a"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-javascript"},"import { IPlugin } from '@alib/build-scripts';\n")))}d.isMDXComponent=!0}}]);